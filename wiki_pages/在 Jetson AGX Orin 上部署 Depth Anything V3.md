# åœ¨ Jetson AGX Orin ä¸Šéƒ¨ç½² Depth Anything V3

![](https://github.com/ByteDance-Seed/Depth-Anything-3/raw/main/assets/images/demo320-2.gif)

## ç®€ä»‹

[Depth Anything V3](https://github.com/ByteDance-Seed/depth-anything-3) æ˜¯ä¸€ä¸ªæœ€å…ˆè¿›çš„å•ç›®æ·±åº¦ä¼°è®¡æ¨¡å‹ï¼Œé€šè¿‡ä»å•ä¸ª RGB å›¾åƒç”Ÿæˆé«˜è´¨é‡æ·±åº¦å›¾æ¥é©æ–° 3D æ„ŸçŸ¥ã€‚ä¸éœ€è¦ä¸“ç”¨ç¡¬ä»¶æˆ–å¤šæ‘„åƒå¤´è¾“å…¥çš„ä¼ ç»Ÿæ·±åº¦ä¼°è®¡æ–¹æ³•ä¸åŒï¼ŒDepth Anything V3 åˆ©ç”¨å…ˆè¿›çš„æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œä»…ä½¿ç”¨æ ‡å‡† 2D å›¾åƒæ¥é¢„æµ‹å‡†ç¡®çš„æ·±åº¦ä¿¡æ¯ã€‚è¿™ä½¿å…¶å¯¹äºç¡¬ä»¶çº¦æŸå’Œè®¡ç®—æ•ˆç‡æ˜¯å…³é”®è€ƒè™‘å› ç´ çš„è¾¹ç¼˜ AI åº”ç”¨ç‰¹åˆ«æœ‰ä»·å€¼ã€‚æœ¬ wiki å°†æŒ‡å¯¼æ‚¨åœ¨ Jetson AGX Orin ä¸Šéƒ¨ç½² Depth Anything V3ï¼Œå¹¶é›†æˆ ROS2 ç”¨äºå®æ—¶æœºå™¨äººåº”ç”¨ã€‚

![](https://media-cdn.seeedstudio.com/media/catalog/product/cache/bb49d3ec4ee05b6f018e93f896b8a25d/5/-/5-100020039-recomputer-mini-j501---carrier-board-for-jetson-agx-orin.jpg)

[**ç«‹å³è´­ä¹° ğŸ–±ï¸**](https://www.seeedstudio.com/reComputer-Mini-J501-Carrier-Board-for-Jetson-AGX-Orin-p-6606.html)

## å…ˆå†³æ¡ä»¶

* **[reComputer Mini J501 è½½æ¿](https://www.seeedstudio.com/reComputer-Robotics-J4012-p-6505.html)**ï¼ˆJetson AGX Orinï¼‰ï¼Œé…å¤‡ JetPack 6.2
* USB æ‘„åƒå¤´
* å·²å®‰è£… [ROS2 Humble](https://wiki.seeedstudio.com/cn/install_ros2_humble/) ç¯å¢ƒ

![](https://files.seeedstudio.com/wiki/deploy_depth_anything_v3/demo.gif)

## æŠ€æœ¯äº®ç‚¹

* **é«˜è´¨é‡å•ç›®æ·±åº¦ä¼°è®¡**ï¼šDepth Anything V3 ä»å•ä¸ª RGB å›¾åƒç”Ÿæˆå‡†ç¡®çš„æ·±åº¦å›¾ï¼Œæ— éœ€ä¸“ç”¨æ·±åº¦ä¼ æ„Ÿå™¨æˆ–ç«‹ä½“æ‘„åƒå¤´è®¾ç½®ã€‚
* **é’ˆå¯¹è¾¹ç¼˜éƒ¨ç½²ä¼˜åŒ–**ï¼šè¯¥æ¨¡å‹ä¸“ä¸ºåœ¨ Jetson AGX Orin ç­‰è¾¹ç¼˜è®¾å¤‡ä¸Šé«˜æ•ˆæ¨ç†è€Œè®¾è®¡ï¼Œé€šè¿‡ TensorRT ä¼˜åŒ–å®ç°æœ€å¤§æ€§èƒ½ã€‚
* **å®æ—¶å¤„ç†**ï¼šèƒ½å¤Ÿå®æ—¶å¤„ç†é«˜åˆ†è¾¨ç‡å›¾åƒï¼Œé€‚ç”¨äºè‡ªä¸»å¯¼èˆªã€éšœç¢ç‰©é¿å…å’Œæœºå™¨äººæ“ä½œä»»åŠ¡ã€‚
* **ROS2 é›†æˆ**ï¼šæä¾›åŸç”Ÿ ROS2 Humble æ”¯æŒï¼Œå…·æœ‰æ·±åº¦å›¾å’Œç‚¹äº‘å‘å¸ƒåŠŸèƒ½ï¼Œå¯æ— ç¼é›†æˆåˆ°æœºå™¨äººç³»ç»Ÿä¸­ã€‚
* **çµæ´»çš„è¾“å…¥æ”¯æŒ**ï¼šæ”¯æŒå„ç§è¾“å…¥æºï¼ŒåŒ…æ‹¬ USB æ‘„åƒå¤´ã€ROS å›¾åƒè¯é¢˜å’Œé¢„å½•åˆ¶è§†é¢‘æµã€‚

## ç¯å¢ƒè®¾ç½®

**æ­¥éª¤ 1.** å®‰è£…ä¾èµ–é¡¹

```
sudo apt update  
sudo apt install -y \  
    build-essential \  
    cmake \  
    git \  
    libopencv-dev \  
    python3-pip \  
    python3-colcon-common-extensions \  
    v4l-utils
```

**æ­¥éª¤ 2.** å®‰è£… Python ä¾èµ–é¡¹

```
pip3 install numpy opencv-python
```

**æ­¥éª¤ 3.** é…ç½® CUDA ç¯å¢ƒå˜é‡

```
# Add CUDA environment variables to .bashrc  
echo '  
# CUDA Environment  
export CUDA_HOME=/usr/local/cuda  
export PATH=$CUDA_HOME/bin:$PATH  
export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH  
export CUDACXX=$CUDA_HOME/bin/nvcc  
' >> ~/.bashrc  
  
# Reload shell configuration  
source ~/.bashrc  
  
# Verify CUDA installation  
nvcc --version
```

![](https://files.seeedstudio.com/wiki/deploy_depth_anything_v3/nvcc.png)

**æ­¥éª¤ 4.** å®‰è£… ROS2 USB æ‘„åƒå¤´åŒ…

```
# Install USB camera driver for ROS2  
sudo apt install -y ros-humble-usb-cam  
  
# Install additional ROS2 dependencies  
sudo apt install -y ros-humble-cv-bridge  
sudo apt install -y ros-humble-image-transport  
sudo apt install -y ros-humble-image-geometry  
sudo apt install -y ros-humble-cv-bridge ros-humble-image-transport ros-humble-rviz2
```

**æ­¥éª¤ 5.** è®¾ç½® Depth Anything V3 ROS2 ç¯å¢ƒ

```
# Clone the repository  
git clone https://github.com/zibochen6/ros2-depth-anything-v3-trt.git  
  
# Navigate to the project directory  
cd ros2-depth-anything-v3-trt
```

**æ­¥éª¤ 6.** æ„å»º ROS2 åŒ…

```
# Build the depth_anything_v3 package with Release configuration  
colcon build --packages-select depth_anything_v3 --cmake-args -DCMAKE_BUILD_TYPE=Release  
  
# Source the workspace  
source install/setup.bash
```

**æ­¥éª¤ 7.** ç”Ÿæˆ TensorRT å¼•æ“

note

åœ¨ç”Ÿæˆå¼•æ“æ–‡ä»¶ä¹‹å‰ï¼Œæ‚¨éœ€è¦æå‰ä¸‹è½½ [Depth Anything V3 çš„ `.onnx` æ¨¡å‹](https://huggingface.co/TillBeemelmanns/Depth-Anything-V3-ONNX)ï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨ ros2-depth-anything-v3-trt/onnx ç›®å½•ä¸­ã€‚

```
# Make the engine generation script executable  
chmod +x generate_engines.sh  
  
# Generate TensorRT engines from ONNX models  
./generate_engines.sh onnx
```

è¯·è€å¿ƒç­‰å¾… `.engine` æ–‡ä»¶çš„ç”Ÿæˆã€‚è½¬æ¢å®Œæˆåï¼Œå°†åœ¨ `onnx` ç›®å½•ä¸­åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

![](https://files.seeedstudio.com/wiki/deploy_depth_anything_v3/engine.png)

## è¿è¡Œæ·±åº¦ä¼°è®¡

### æ‘„åƒå¤´æ·±åº¦ä¼°è®¡

**æ­¥éª¤ 1.** è¿æ¥ USB æ‘„åƒå¤´

å°†æ‚¨çš„ USB æ‘„åƒå¤´è¿æ¥åˆ° Jetson AGX Orin è®¾å¤‡ã€‚éªŒè¯æ‘„åƒå¤´æ˜¯å¦è¢«æ£€æµ‹åˆ°ï¼š

```
# Check if USB camera is detected  
ls /dev/video*
```

**é¢„æœŸè¾“å‡ºï¼š**

```
/dev/video0  /dev/video1
```

**æ­¥éª¤ 2.** æ‘„åƒå¤´æ ‡å®š

`v4l2_camera` åŒ…å……å½“ Linux Video4Linux2 (V4L2) API å’Œ ROS 2 è¯é¢˜ä¹‹é—´çš„æ¡¥æ¢ï¼Œå‘å¸ƒå¯åœ¨æ ‡å®šæµæ°´çº¿ä¸­è½»æ¾ä½¿ç”¨çš„å›¾åƒå’Œæ‘„åƒå¤´ä¿¡æ¯æ¶ˆæ¯ã€‚

å®‰è£…æ‘„åƒå¤´æ ‡å®šåŒ…ï¼š

```
# Install Camera Calibration Package  
sudo apt install ros-humble-camera-calibration  
  
# v4l2_camera is the official ROS2 maintained node that can directly publish USB camera images  
sudo apt install ros-${ROS_DISTRO}-v4l2-camera
```

å¯åŠ¨æ‘„åƒå¤´èŠ‚ç‚¹ï¼š

```
# Launch camera node  
ros2 run v4l2_camera v4l2_camera_node \  
  --ros-args \  
  -p image_size:=[640,480] \  
  -p pixel_format:=YUYV
```

é»˜è®¤å‘å¸ƒçš„è¯é¢˜æœ‰ï¼š

* `/image_raw` - åŸå§‹æ‘„åƒå¤´å›¾åƒ
* `/camera` - æ‘„åƒå¤´ä¿¡æ¯

![](https://files.seeedstudio.com/wiki/robotics/Sensor/Camera/PyCuVSLAM/image.png)

è¿è¡Œæ‘„åƒå¤´æ ‡å®šï¼š

```
# In another terminal  
ros2 run camera_calibration cameracalibrator \  
  --size 8x6 \  
  --square 0.025 \  
  --fisheye-recompute-extrinsicsts \  
  --fisheye-fix-skew \  
  --ros-args --remap image:=/image_raw --remap camera:=/v4l2_camera
```

note

* `--size 8x6` æŒ‡çš„æ˜¯å†…è§’ç‚¹æ•°é‡ï¼ˆ8Ã—6 = 48 ä¸ªè§’ç‚¹ï¼Œå¯¹åº” 9Ã—7 ç½‘æ ¼ï¼‰
* `--square 0.025` æŒ‡çš„æ˜¯æ–¹æ ¼å¤§å°ï¼Œå•ä½ä¸ºç±³ï¼ˆ25mmï¼‰
* ç§»åŠ¨æ‘„åƒå¤´ä»ä¸åŒè§’åº¦æ•è·å›¾åƒï¼Œç›´åˆ° `CALIBRATE` æŒ‰é’®äº®èµ·

![](https://files.seeedstudio.com/wiki/robotics/Sensor/Camera/PyCuVSLAM/cal2.png)

æ ‡å®šæˆåŠŸåï¼Œæ‚¨å°†åœ¨ç»ˆç«¯ä¸­è·å¾—ç±»ä¼¼çš„æ‘„åƒå¤´å‚æ•°ï¼š

![](https://files.seeedstudio.com/wiki/robotics/Sensor/Camera/PyCuVSLAM/cal3.png)

æ‚¨å¯ä»¥å‚è€ƒ[æ­¤ wiki](https://wiki.seeedstudio.com/cn/pycuvslam_recomputer_robotics/#camera-calibration) è¿›è¡Œæ‘„åƒå¤´æ ‡å®šã€‚
å°†æ ‡å®šå‚æ•°å†™å…¥ `camera_info_example.yaml` æ–‡ä»¶

**æ­¥éª¤ 3.** å¯åŠ¨ USB æ‘„åƒå¤´èŠ‚ç‚¹

å°†æ ‡å®šå‚æ•°ä¿å­˜åˆ° `camera_info_example.yaml` æ–‡ä»¶ä¸­ï¼Œä»¥æ ¡æ­£ GMSL æ‘„åƒå¤´çš„é±¼çœ¼ç•¸å˜ã€‚ç„¶åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®æ—¶æ·±åº¦ä¼°è®¡ï¼š

```
#Start the script for camera depth estimation  
CAMERA_INFO_FILE=camera_info_example.yaml ENABLE_UNDISTORTION=1 ./run_camera_depth.sh
```

### è§†é¢‘æ·±åº¦ä¼°è®¡

**æ­¥éª¤ 1.** å‡†å¤‡è§†é¢‘æ–‡ä»¶

å‡†å¤‡ä¸€ä¸ªç”¨äºæ·±åº¦ä¼°è®¡çš„è§†é¢‘æ–‡ä»¶ã€‚

**æ­¥éª¤ 2.** å¯åŠ¨è§†é¢‘æ·±åº¦ä¼°è®¡èŠ‚ç‚¹

```
#Start the script for video depth estimation  
./run_video_depth.sh
```

![](https://files.seeedstudio.com/wiki/deploy_depth_anything_v3/da3.gif)

## å‚è€ƒèµ„æ–™

* [Depth Anything V3 GitHub ä»“åº“](https://github.com/DepthAnything/Depth-Anything-V3)
* [ROS2 Depth Anything V3 TRT ä»“åº“](https://github.com/ika-rwth-aachen/ros2-depth-anything-v3-trt)
* [TensorRT æ–‡æ¡£](https://developer.nvidia.com/tensorrt)
* [ROS2 Humble æ–‡æ¡£](https://docs.ros.org/en/humble/)

## æŠ€æœ¯æ”¯æŒä¸äº§å“è®¨è®º

æ„Ÿè°¢æ‚¨é€‰æ‹©æˆ‘ä»¬çš„äº§å“ï¼æˆ‘ä»¬åœ¨è¿™é‡Œä¸ºæ‚¨æä¾›ä¸åŒçš„æ”¯æŒï¼Œä»¥ç¡®ä¿æ‚¨ä½¿ç”¨æˆ‘ä»¬äº§å“çš„ä½“éªŒå°½å¯èƒ½é¡ºç•…ã€‚æˆ‘ä»¬æä¾›å¤šç§æ²Ÿé€šæ¸ é“ï¼Œä»¥æ»¡è¶³ä¸åŒçš„åå¥½å’Œéœ€æ±‚ã€‚